{"ast":null,"code":"var _jsxFileName = \"/home/jonnie/React App/E Commerce/ecommerceapp/src/App.js\";\nimport React, { Component } from \"react\";\nimport { Switch, Route, Link, BrowserRouter as Router } from \"react-router-dom\";\nimport AddProduct from './components/AddProduct';\nimport Cart from './components/Cart';\nimport Login from './components/Login';\nimport ProductList from './components/ProductList';\nimport Context from \"./Context\";\nimport axios from 'axios';\nimport jwt_decode from 'jwt-decode';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.checkout = () => {\n      if (!this.state.user) {\n        this.routerRef.current.history.push(\"/login\");\n        return;\n      }\n\n      const cart = this.state.cart;\n      const products = this.state.products.map(p => {\n        if (cart[p.name]) {\n          p.stock = p.stock - cart[p.name].amount;\n          axios.put(`http://localhost:3001/products/${p.id}`, { ...p\n          });\n        }\n\n        return p;\n      });\n      this.setState({\n        products\n      });\n      this.clearCart();\n    };\n\n    this.addProduct = (product, callback) => {\n      let products = this.state.products.slice();\n      products.push(product);\n      this.setState({\n        products\n      }, () => callback && callback());\n    };\n\n    this.addToCart = cartItem => {\n      let cart = this.state.cart;\n\n      if (cart[cartItem.id]) {\n        cart[cartItem.id].amount += cartItem.amount;\n      } else {\n        cart[cartItem.id] = cartItem;\n      }\n\n      if (cart[cartItem.id].amount > cart[cartItem.id].product.stock) {\n        cart[cartItem.id].amount = cart[cartItem.id].product.stock;\n      }\n\n      localStorage.setItem(\"cart\", JSON.stringify(cart));\n      this.setState({\n        cart\n      });\n    };\n\n    this.removeFromCart = cartItemId => {\n      let cart = this.state.cart;\n      delete cart[cartItemId];\n      localStorage.setItem(\"cart\", JSON.stringify(cart));\n      this.setState({\n        cart\n      });\n    };\n\n    this.clearCart = () => {\n      let cart = {};\n      localStorage.removeItem(\"cart\");\n      this.setState({\n        cart\n      });\n    };\n\n    this.login = async (email, password) => {\n      const res = await axios.post('http://localhost:3001/login', {\n        email,\n        password\n      }).catch(res => {\n        return {\n          status: 401,\n          message: 'Unauthorized'\n        };\n      });\n\n      if (res.status === 200) {\n        const {\n          email\n        } = jwt_decode(res.data.accessToken);\n        const user = {\n          email,\n          token: res.data.accessToken,\n          accessLevel: email === 'admin@example.com' ? 0 : 1\n        };\n        this.setState({\n          user\n        });\n        localStorage.setItem(\"user\", JSON.stringify(user));\n        return true;\n      } else {\n        return false;\n      }\n    };\n\n    this.logout = e => {\n      e.preventDefault();\n      this.setState({\n        user: null\n      });\n      localStorage.removeItem(\"user\");\n    };\n\n    this.state = {\n      user: null,\n      cart: {},\n      products: []\n    };\n    this.routerRef = /*#__PURE__*/React.createRef();\n  }\n\n  async componentDidMount() {\n    let user = localStorage.getItem(\"user\");\n    let cart = localStorage.getItem(\"cart\");\n    const products = await axios.get('http://localhost:3001/products');\n    user = user ? JSON.parse(user) : null;\n    cart = cart ? JSON.parse(cart) : {};\n    this.setState({\n      user,\n      products: products.data,\n      cart\n    });\n  }\n\n  async componentDidMount() {\n    let user = localStorage.getItem(\"user\");\n    const products = await axios.get('http://localhost:3001/products');\n    user = user ? JSON.parse(user) : null;\n    this.setState({\n      user,\n      products: products.data\n    });\n  }\n\n  componentDidMount() {\n    let user = localStorage.getItem(\"user\");\n    user = user ? JSON.parse(user) : null;\n    this.setState({\n      user\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(Context.Provider, {\n      value: { ...this.state,\n        removeFromCart: this.removeFromCart,\n        addToCart: this.addToCart,\n        login: this.login,\n        addProduct: this.addProduct,\n        clearCart: this.clearCart,\n        checkout: this.checkout\n      },\n      children: /*#__PURE__*/_jsxDEV(Router, {\n        ref: this.routerRef,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"App\",\n          children: [/*#__PURE__*/_jsxDEV(\"nav\", {\n            className: \"navbar container\",\n            role: \"navigation\",\n            \"aria-label\": \"main navigation\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"navbar-brand\",\n              children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                className: \"navbar-item is-size-4 \",\n                children: \"NEW WORLD ENTERP\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 150,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                role: \"button\",\n                class: \"navbar-burger burger\",\n                \"aria-label\": \"menu\",\n                \"aria-expanded\": \"false\",\n                \"data-target\": \"navbarBasicExample\",\n                onClick: e => {\n                  e.preventDefault();\n                  this.setState({\n                    showMenu: !this.state.showMenu\n                  });\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  \"aria-hidden\": \"true\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 162,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  \"aria-hidden\": \"true\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 163,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  \"aria-hidden\": \"true\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 164,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 151,\n                columnNumber: 15\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 149,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `navbar-menu ${this.state.showMenu ? \"is-active\" : \"\"}`,\n              children: [/*#__PURE__*/_jsxDEV(Link, {\n                to: \"/products\",\n                className: \"navbar-item\",\n                children: \"Products\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 170,\n                columnNumber: 17\n              }, this), this.state.user && this.state.user.accessLevel < 1 && /*#__PURE__*/_jsxDEV(Link, {\n                to: \"/add-product\",\n                className: \"navbar-item\",\n                children: \"Add Product\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 174,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Link, {\n                to: \"/cart\",\n                className: \"navbar-item\",\n                children: [\"Cart\", /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"tag is-primary\",\n                  style: {\n                    marginLeft: \"5px\"\n                  },\n                  children: Object.keys(this.state.cart).length\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 180,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 178,\n                columnNumber: 17\n              }, this), !this.state.user ? /*#__PURE__*/_jsxDEV(Link, {\n                to: \"/login\",\n                className: \"navbar-item\",\n                children: \"Login\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 188,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Link, {\n                to: \"/\",\n                onClick: this.logout,\n                className: \"navbar-item\",\n                children: \"Logout\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 192,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 167,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(Switch, {\n            children: [/*#__PURE__*/_jsxDEV(Route, {\n              exact: true,\n              path: \"/\",\n              component: ProductList\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              exact: true,\n              path: \"/login\",\n              component: Login\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              exact: true,\n              path: \"/cart\",\n              component: Cart\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              exact: true,\n              path: \"/add-product\",\n              component: AddProduct\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 202,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              exact: true,\n              path: \"/products\",\n              component: ProductList\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/home/jonnie/React App/E Commerce/ecommerceapp/src/App.js"],"names":["React","Component","Switch","Route","Link","BrowserRouter","Router","AddProduct","Cart","Login","ProductList","Context","axios","jwt_decode","App","constructor","props","checkout","state","user","routerRef","current","history","push","cart","products","map","p","name","stock","amount","put","id","setState","clearCart","addProduct","product","callback","slice","addToCart","cartItem","localStorage","setItem","JSON","stringify","removeFromCart","cartItemId","removeItem","login","email","password","res","post","catch","status","message","data","accessToken","token","accessLevel","logout","e","preventDefault","createRef","componentDidMount","getItem","get","parse","render","showMenu","marginLeft","Object","keys","length"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Switch, Route, Link, BrowserRouter as Router } from \"react-router-dom\";\n\nimport AddProduct from './components/AddProduct';\nimport Cart from './components/Cart';\nimport Login from './components/Login';\nimport ProductList from './components/ProductList';\n\nimport Context from \"./Context\";\nimport axios from 'axios';\nimport jwt_decode from 'jwt-decode';\n\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      user: null,\n      cart: {},\n      products: []\n    };\n    this.routerRef = React.createRef();\n  }\n  checkout = () => {\n    if (!this.state.user) {\n      this.routerRef.current.history.push(\"/login\");\n      return;\n    }\n  \n    const cart = this.state.cart;\n  \n    const products = this.state.products.map(p => {\n      if (cart[p.name]) {\n        p.stock = p.stock - cart[p.name].amount;\n  \n        axios.put(\n          `http://localhost:3001/products/${p.id}`,\n          { ...p },\n        )\n      }\n      return p;\n    });\n  \n    this.setState({ products });\n    this.clearCart();\n  };\n  addProduct = (product, callback) => {\n    let products = this.state.products.slice();\n    products.push(product);\n    this.setState({ products }, () => callback && callback());\n  };\n  async componentDidMount() {\n    let user = localStorage.getItem(\"user\");\n    let cart = localStorage.getItem(\"cart\");\n  \n    const products = await axios.get('http://localhost:3001/products');\n    user = user ? JSON.parse(user) : null;\n    cart = cart? JSON.parse(cart) : {};\n  \n    this.setState({ user,  products: products.data, cart });\n  }\n  addToCart = cartItem => {\n    let cart = this.state.cart;\n    if (cart[cartItem.id]) {\n      cart[cartItem.id].amount += cartItem.amount;\n    } else {\n      cart[cartItem.id] = cartItem;\n    }\n    if (cart[cartItem.id].amount > cart[cartItem.id].product.stock) {\n      cart[cartItem.id].amount = cart[cartItem.id].product.stock;\n    }\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    this.setState({ cart });\n  };\n  removeFromCart = cartItemId => {\n    let cart = this.state.cart;\n    delete cart[cartItemId];\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    this.setState({ cart });\n  };\n  \n  clearCart = () => {\n    let cart = {};\n    localStorage.removeItem(\"cart\");\n    this.setState({ cart });\n  };\n    \n  async componentDidMount() {\n    let user = localStorage.getItem(\"user\");\n    const products = await axios.get('http://localhost:3001/products');\n    user = user ? JSON.parse(user) : null;\n    this.setState({ user,  products: products.data });\n  }\n  \n  componentDidMount() {\n    let user = localStorage.getItem(\"user\");\n    user = user ? JSON.parse(user) : null;\n    this.setState({ user });\n  }\n  login = async (email, password) => {\n    const res = await axios.post(\n      'http://localhost:3001/login',\n      { email, password },\n    ).catch((res) => {\n      return { status: 401, message: 'Unauthorized' }\n    })\n  \n    if(res.status === 200) {\n      const { email } = jwt_decode(res.data.accessToken)\n      const user = {\n        email,\n        token: res.data.accessToken,\n        accessLevel: email === 'admin@example.com' ? 0 : 1\n      }\n  \n      this.setState({ user });\n      localStorage.setItem(\"user\", JSON.stringify(user));\n      return true;\n    } else {\n      return false;\n    }\n  }\n  \n  logout = e => {\n    e.preventDefault();\n    this.setState({ user: null });\n    localStorage.removeItem(\"user\");\n  };\n\n  render() {\n    return (\n      <Context.Provider\n        value={{\n          ...this.state,\n          removeFromCart: this.removeFromCart,\n          addToCart: this.addToCart,\n          login: this.login,\n          addProduct: this.addProduct,\n          clearCart: this.clearCart,\n          checkout: this.checkout\n        }}\n      >\n        <Router ref={this.routerRef}>\n        <div className=\"App\">\n          <nav\n            className=\"navbar container\"\n            role=\"navigation\"\n            aria-label=\"main navigation\"\n          >\n            <div className=\"navbar-brand\">\n              <b className=\"navbar-item is-size-4 \">NEW WORLD ENTERP</b>\n              <label\n                role=\"button\"\n                class=\"navbar-burger burger\"\n                aria-label=\"menu\"\n                aria-expanded=\"false\"\n                data-target=\"navbarBasicExample\"\n                onClick={e => {\n                  e.preventDefault();\n                  this.setState({ showMenu: !this.state.showMenu });\n                }}\n              >\n                <span aria-hidden=\"true\"></span>\n                <span aria-hidden=\"true\"></span>\n                <span aria-hidden=\"true\"></span>\n              </label>\n            </div>\n              <div className={`navbar-menu ${\n                  this.state.showMenu ? \"is-active\" : \"\"\n                }`}>\n                <Link to=\"/products\" className=\"navbar-item\">\n                  Products\n                </Link>\n                {this.state.user && this.state.user.accessLevel < 1 && (\n                  <Link to=\"/add-product\" className=\"navbar-item\">\n                    Add Product\n                  </Link>\n                )}\n                <Link to=\"/cart\" className=\"navbar-item\">\n                  Cart\n                  <span\n                    className=\"tag is-primary\"\n                    style={{ marginLeft: \"5px\" }}\n                  >\n                    { Object.keys(this.state.cart).length }\n                  </span>\n                </Link>\n                {!this.state.user ? (\n                  <Link to=\"/login\" className=\"navbar-item\">\n                    Login\n                  </Link>\n                ) : (\n                  <Link to=\"/\" onClick={this.logout} className=\"navbar-item\">\n                    Logout\n                  </Link>\n                )}\n              </div>\n            </nav>\n            <Switch>\n              <Route exact path=\"/\" component={ProductList} />\n              <Route exact path=\"/login\" component={Login} />\n              <Route exact path=\"/cart\" component={Cart} />\n              <Route exact path=\"/add-product\" component={AddProduct} />\n              <Route exact path=\"/products\" component={ProductList} />\n            </Switch>\n          </div>\n        </Router>\n      </Context.Provider>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}